!function(a){a.fn.pekeUpload=function(b){var c={dragMode:!1,dragText:"Drag and Drop your files here",bootstrap:!1,btnText:"Browse files...",allowedExtensions:"",invalidExtError:"Invalid File Type",maxSize:0,sizeError:"Size of the file is greather than allowed",showPreview:!0,showFilename:!0,showPercent:!0,showErrorAlerts:!0,errorOnResponse:"There has been an error uploading your file",onSubmit:!1,url:"upload.php",data:null,limit:0,limitError:"You have reached the limit of files that you can upload",delfiletext:"Remove from queue",onFileError:function(a,b){},onFileSuccess:function(a,b){}},b=a.extend(c,b),d={obj:a(this),files:[],uparea:null,container:null,uploadedfiles:0,hasErrors:!1,init:function(){this.replacehtml(),this.uparea.on("click",function(){d.selectfiles()}),b.dragMode&&this.handledragevents(),this.handlebuttonevents(),a(document).on("click",".pkwrncl",function(){a(this).parent("div").remove()}),b.onSubmit&&this.handleFormSubmission()},replacehtml:function(){var c=null;switch(b.dragMode){case!0:switch(b.bootstrap){case!0:c='<div class="well well-lg pkuparea pkdragarea" style="cursor:pointer"><h4>'+b.dragText+"</h4></div>";break;case!1:c='<div class="pekeupload-drag-area pkuparea pkdragarea" style="cursor:pointer"><h4>'+b.dragText+"</h4></div>"}break;case!1:switch(b.bootstrap){case!0:c='<a href="javascript:void(0)" class="btn btn-primary btn-upload pkuparea"> <i class="glyphicon glyphicon-upload"></i> '+b.btnText+"</a>";break;case!1:c='<a href="javascript:void(0)" class="pekeupload-btn-file pkuparea">'+b.btnText+"</a>"}}this.obj.hide(),this.uparea=a(c).insertAfter(this.obj),this.container=a('<div class="pekecontainer"><ul></ul></div>').insertAfter(this.uparea)},selectfiles:function(){this.obj.click()},handlebuttonevents:function(){a(document).on("change",this.obj.selector,function(){d.checkFile(d.obj[0].files[0])}),a(document).on("click",".pkdel",function(){var b=a(this).parent("div").parent("div");d.delAndRearrange(b)})},handledragevents:function(){a(document).on("dragenter",function(a){a.stopPropagation(),a.preventDefault()}),a(document).on("dragover",function(a){a.stopPropagation(),a.preventDefault()}),a(document).on("drop",function(a){a.stopPropagation(),a.preventDefault()}),this.uparea.on("dragenter",function(b){b.stopPropagation(),b.preventDefault(),a(this).css("border","2px solid #0B85A1")}),this.uparea.on("dragover",function(a){a.stopPropagation(),a.preventDefault()}),this.uparea.on("drop",function(b){a(this).css("border","2px dotted #0B85A1"),b.preventDefault();for(var c=b.originalEvent.dataTransfer.files,e=0;e<c.length;e++)d.checkFile(c[e])})},checkFile:function(a){error=this.validateFile(a),error?(b.showErrorAlerts&&this.addWarning(error),this.hasErrors=!0,b.onFileError(a,error)):(this.files.push(a),this.files.length>b.limit&&b.limit>0?(this.files.splice(this.files.length-1,1),b.showErrorAlerts&&this.addWarning(b.limitError,this.obj),this.hasErrors=!0,b.onFileError(a,error)):(this.addRow(a),0==b.onSubmit&&this.upload(a,this.files.length-1)))},addWarning:function(c,d){var e=null;switch(b.bootstrap){case!0:e='<div class="alert alert-danger"><button type="button" class="close pkwrncl" data-dismiss="alert">&times;</button> '+c+"</div>";break;case!1:e='<div class="alert-pekeupload"><button type="button" class="close pkwrncl" data-dismiss="alert">&times;</button> '+c+"</div>"}d?a(e).insertBefore(d):this.container.append(e)},validateFile:function(a){return this.checkExtension(a)?this.checkSize(a)?null:b.sizeError:b.invalidExtError},checkExtension:function(c){if(""==b.allowedExtensions)return!0;var d=c.name.split(".").pop().toLowerCase(),e=b.allowedExtensions.split("|");return a.inArray(d,e)!=-1},checkSize:function(a){return 0==b.maxSize||!(a.size>b.maxSize)},addRow:function(c){var d=this.files.length-1;switch(b.bootstrap){case!0:var e=a('<div class="row pkrw" rel="'+d+'"></div>').appendTo(this.container);if(b.showPreview){var f=a('<div class="col-lg-2 col-md-2 col-xs-4"></div>').appendTo(e);this.previewFile(f,c)}var g=a('<div class="col-lg-8 col-md-8 col-xs-8"></div>').appendTo(e);if(b.showFilename&&g.append('<div class="filename">'+c.name+"</div>"),0==b.notAjax){var h=a('<div class="progress"><div class="pkuppbr progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em;"></div></div>').appendTo(g);b.showPercent&&h.find("div.progress-bar").text("0%")}var i=a('<div class="col-lg-2 col-md-2 col-xs-2"></div>').appendTo(e);a('<a href="javascript:void(0);" class="btn btn-danger pkdel">'+b.delfiletext+"</a>").appendTo(i);break;case!1:var e=a('<div class="pekerow pkrw" rel="'+d+'"></div>').appendTo(this.container);if(b.showPreview){var f=a('<div class="pekeitem_preview"></div>').appendTo(e);this.previewFile(f,c)}var g=a('<div class="file"></div>').appendTo(e);if(b.showFilename&&g.append('<div class="filename">'+c.name+"</div>"),0==b.notAjax){var h=a('<div class="progress-pekeupload"><div class="pkuppbr bar-pekeupload pekeup-progress-bar" style="min-width: 2em;width:0%"><span></span></div></div>').appendTo(g);b.showPercent&&h.find("div.bar-pekeupload").text("0%")}var i=a('<div class="pkdelfile"></div>').appendTo(e);a('<a href="javascript:void(0);" class="delbutton pkdel">'+b.delfiletext+"</a>").appendTo(i)}},previewFile:function(c,d){var e=d.type.split("/")[0];switch(e){case"image":var f=window.URL.createObjectURL(d);a('<img class="thumbnail" src="'+f+'" height="64" />').appendTo(c);break;case"video":var f=window.URL.createObjectURL(d);a('<video src="'+f+'" width="100%" controls></video>').appendTo(c);break;case"audio":var f=window.URL.createObjectURL(d);a('<audio src="'+f+'" width="100%" controls></audio>').appendTo(c);break;default:if(b.bootstrap){a('<i class="glyphicon glyphicon-file"></i>').appendTo(c)}else{a('<div class="pekeupload-item-file"></div>').appendTo(c)}}},upload:function(c,e){var f=new FormData;f.append(this.obj.attr("name"),c);for(var g in b.data)f.append(g,b.data[g]);a.ajaxSetup({headers:{"X-CSRF-TOKEN":b.tokenF}}),a.ajax({url:b.url,type:"POST",data:f,dataType:"json",success:function(f){if(1==f||1==f.success)d.files[e]=null,a('div.row[rel="'+e+'"]').find(".pkuppbr").css("width","100%"),b.onFileSuccess(c,f);else{d.files.splice(e,1);var g=null;g=error in f?null:b.errorOnResponse,b.showErrorAlerts&&d.addWarning(g,a('div.row[rel="'+e+'"]')),a('div.row[rel="'+e+'"]').remove(),d.hasErrors=!0,b.onFileError(c,g)}},error:function(f,g,h){d.files.splice(e,1),b.showErrorAlerts&&d.addWarning(h,a('div.pkrw[rel="'+e+'"]')),d.hasErrors=!0,b.onFileError(c,h),a('div.pkrw[rel="'+e+'"]').remove()},xhr:function(){return myXhr=a.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(a){d.handleProgress(a,e)},!1),myXhr},complete:function(){b.onSubmit&&(d.uploadedfiles++,d.uploadedfiles==d.files.length&&0==d.hasErrors&&(d.obj.remove(),d.obj.parent("form").submit()))},cache:!1,contentType:!1,processData:!1})},handleProgress:function(c,d){if(c.lengthComputable){var g=(c.total,c.loaded,Number((100*c.loaded/c.total).toFixed(2))),h=a('div.pkrw[rel="'+d+'"]').find(".pkuppbr");h.css("width",g+"%"),b.showPercent&&h.text(g+"%")}},handleFormSubmission:function(){var a=this.obj.parent("form");a.submit(function(){d.hasErrors=!1,d.uploadedfiles=0;for(var a=0;a<d.files.length;a++)if(d.files[a])d.upload(d.files[a],a);else if(d.uploadedfiles++,d.uploadedfiles==d.files.length&&0==d.hasErrors)return d.obj.remove(),!0;return!1})},delAndRearrange:function(b){var c=b.attr("rel");d.files.splice(parseInt(c),1),b.remove(),d.container.find("div.pkrw").each(function(b){a(this).attr("rel",b)})}};d.init()}}(jQuery);
